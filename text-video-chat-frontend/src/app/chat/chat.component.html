<div class="container mt-5">
  <!-- Place this code at the top or where you want the logout button to be -->
  <div class="d-flex justify-content-between mb-4">
    <span class="align-self-center"
      >Hello, <strong>{{ currentUser?.username }}</strong></span
    >
    <!-- Display the current user's name. We use the safe navigation operator (?) to avoid null reference errors -->
    <div>
      <button (click)="logout()" class="btn btn-warning">Logout</button>
      <button (click)="deleteAccount()" class="btn btn-danger mx-2">
        Delete Account
      </button>
      <button
        *ngIf="isAdmin"
        (click)="navigateToDashboard()"
        class="btn btn-info"
      >
        Dashboard
      </button>
    </div>
  </div>

  <div class="list-group">
    <div *ngFor="let group of allGroups" class="list-group-item">
      <div class="d-flex justify-content-between align-items-center mb-3">
        {{ group.name }}

        <!-- Group Membership Control -->
        <ng-container
          *ngIf="isMemberOfGroup(group._id); else notMemberTemplate"
        >
          <button (click)="leaveGroup(group._id)" class="btn btn-danger">
            Leave
          </button>
        </ng-container>

        <ng-template #notMemberTemplate>
          <ng-container *ngIf="isPending(group._id); else joinButtonTemplate">
            <span class="badge badge-warning badge-pill text-dark"
              >Pending</span
            >
          </ng-container>
          <ng-template #joinButtonTemplate>
            <button
              class="btn btn-primary"
              (click)="requestToJoinGroup(group._id)"
            >
              Join
            </button>
          </ng-template>
        </ng-template>
      </div>

      <!-- Channel List -->
      <div *ngIf="isMemberOfGroup(group._id)">
        <div
          *ngFor="let channel of group.channels"
          class="d-flex justify-content-between align-items-center mb-2"
        >
          {{ channel.name }}

          <!-- Add user to channel using a dropdown -->
          <ng-container *ngIf="!isChannelMember(channel._id, group._id)">
            <button
              class="btn btn-sm btn-primary"
              (click)="joinChannel(currentUser?._id || '', channel._id)"
            >
              Join Channel
            </button>
          </ng-container>

          <!-- Display input field if the user is a member of the channel -->
          <ng-container *ngIf="isChannelMember(channel._id, group._id)">
            <input
              type="text"
              placeholder="Type your message here..."
              class="form-control mx-2"
            />
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>
