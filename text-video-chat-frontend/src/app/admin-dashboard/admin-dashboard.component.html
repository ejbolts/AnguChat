<div class="container mt-5">
  <h2 class="admin-title">Admin Dashboard</h2>
  <button (click)="logout()" class="btn btn-warning">Logout</button>

  <table class="table table-striped mt-3">
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Change Role</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.role }}</td>
        <td>
          <select [(ngModel)]="user.newRole" class="form-control">
            <option value="user">Chat User</option>
            <option value="groupAdmin">Group Admin</option>
            <option value="superAdmin">Super Admin</option>
          </select>
        </td>
        <td>
          <button (click)="promoteUser(user)" class="btn btn-primary mr-2">
            Promote
          </button>
          <button (click)="removeUser(user)" class="btn btn-danger">
            Remove
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- Create Group -->
  <div class="input-group mb-3">
    <input
      type="text"
      class="form-control"
      placeholder="Group Name"
      #groupInput
    />
    <div class="input-group-append">
      <button (click)="createGroup(groupInput)" class="btn btn-primary">
        Create Group
      </button>
    </div>
  </div>

  <!-- List Groups and Channels -->
  <div *ngFor="let group of groups" class="mb-4">
    <div class="bg-light p-3 rounded">
      <h3 class="d-inline-block mr-3">{{ group.name }}</h3>
      <button (click)="removeGroup(group.id)" class="btn btn-danger btn-sm">
        Remove Group
      </button>
      <!-- Add Channel to Group -->
      <div class="input-group mt-3 mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="Channel Name"
          #channelInput
        />
        <div class="input-group-append">
          <button
            (click)="createChannel(group.id, channelInput)"
            class="btn btn-secondary"
          >
            Add Channel
          </button>
        </div>
      </div>

      <!-- Add User to Group -->
      <div class="input-group mt-3 mb-3">
        <select class="form-control" #userDropdown>
          <option *ngFor="let user of users" [value]="user.id">
            {{ user.username }}
          </option>
        </select>
        <div class="input-group-append">
          <button
            (click)="addUserToGroup(userDropdown.value, group.id)"
            class="btn btn-secondary"
          >
            Add User
          </button>
        </div>
      </div>
    </div>

    <!-- List Users in Group with Remove Option -->
    <ul class="list-group">
      <li
        *ngFor="let userId of group.users"
        class="list-group-item d-flex justify-content-between align-items-center"
      >
        {{ getUsernameById(userId) }}

        <button
          (click)="removeUserFromGroup(userId, group.id)"
          class="btn btn-danger btn-sm"
        >
          Remove
        </button>
      </li>
    </ul>
    <!-- List Channels -->
    <div *ngFor="let channel of group.channels">
      {{ channel.name }}

      <!-- Add user to channel using a dropdown -->
      <select #userDropdown>
        <option *ngFor="let userId of group.users" [value]="userId">
          {{ getUserById(userId)?.username || "Unknown" }}
        </option>
      </select>
      <button
        (click)="addUserToChannel(userDropdown.value, channel.id)"
        class="btn btn-primary btn-sm"
      >
        Add User
      </button>

      <div *ngFor="let channel of group.channels">
        <div *ngFor="let channel of group.channels">
          <!-- Existing users in the channel -->
          <div *ngFor="let userId of channel.users">
            {{ getUserIdName(userId) }}
            <button
              (click)="banUserFromChannel(userId, channel.id)"
              class="btn btn-warning btn-sm"
            >
              Ban
            </button>
            <button
              (click)="removeUserFromChannel(userId, channel.id)"
              class="btn btn-danger btn-sm"
            >
              Remove User
            </button>
          </div>

          <!-- Banned users from the channel -->
          <div *ngFor="let bannedUserId of channel.bannedUsers">
            {{ getUserIdName(bannedUserId) }} (Banned)
            <button
              (click)="unbanUserFromChannel(bannedUserId, channel.id)"
              class="btn btn-info btn-sm"
            >
              Unban
            </button>
          </div>
        </div>
      </div>

      <button
        (click)="removeChannel(group.id, channel.id)"
        class="btn btn-danger btn-sm"
      >
        Remove Channel
      </button>
    </div>
  </div>
</div>
